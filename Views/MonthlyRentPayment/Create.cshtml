@model MonthlyRentPayment
@{
    ViewData["Title"] = "Create Monthly Rent Payment";
}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    .select2-container--default .select2-selection--single {
        height: 42px;
        border: 1px solid #d1d5db; 
        border-radius: 0.375rem; 
        padding: 6px 12px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: #374151; 
            line-height: 28px;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 40px;
        }
</style>
<div class="max-w-4xl mx-auto">
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h1 class="text-2xl font-bold text-gray-900">Create Monthly Rent Payment</h1>
        </div>

        <form asp-action="Create" method="post" class="px-6 py-4 space-y-6">
            <div asp-validation-summary="ModelOnly" class="text-red-600"></div>


            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="EmployeeId" class="block text-sm font-medium text-gray-700 mb-1">Name (Employee)</label>
                    <select asp-for="EmployeeId" class="searchable-dropdown w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Employees, "Id", "Name"))">
                        <option value="0">Select</option>
                    </select>
                 
                    <span asp-validation-for="EmployeeId" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="VendorId" class="block text-sm font-medium text-gray-700 mb-1">Owner's Name</label>

                    <select asp-for="VendorId" class="searchable-dropdown w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Vendors, "Id", "Name"))">
                        <option value="0">Select</option>
                    </select>
                    <span asp-validation-for="VendorId" class="text-red-500 text-sm"></span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="LeaseId" class="block text-sm font-medium text-gray-700 mb-1">Lease Ref.</label>

                    <select asp-for="LeaseId" class="searchable-dropdown w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Leases, "Id", "Name"))">
                        <option value="0">Select</option>
                    </select>
                    <span asp-validation-for="LeaseId" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="PaymentMonth" class="block text-sm font-medium text-gray-700 mb-1">Payment Month</label>
                    <input asp-for="PaymentMonth" type="month" class="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    <span asp-validation-for="PaymentMonth" class="text-red-500 text-sm"></span>
                </div>
               
            </div> 
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="MonthlyLeaseAmount" class="block font-medium text-gray-700 mb-1">Monthly Lease Amount</label>
                    <input asp-for="MonthlyLeaseAmount" id="MonthlyLeaseAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" type="number" step="0.01" />
                    <span asp-validation-for="MonthlyLeaseAmount" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="TDSApplicableId" class="block font-medium text-gray-700 mb-1">TDS Applicable</label>
             
                    <select asp-for="TDSApplicableId" class="searchable-dropdown w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="0">Select TDS Applicable</option>
                        @foreach (var item in ViewBag.TDSApplicable)
                        {
                            <option value="@item.Id" data-rate="@item.Rate">@item.Name</option>
                        }
                    </select>
                    <span asp-validation-for="TDSApplicableId" class="text-red-500 text-sm"></span>
                </div>
                
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="TDSRate" class="block font-medium text-gray-700 mb-1">TDS Rate</label>
                    <input asp-for="TDSRate" id="TDSRate" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
                <div>
                    <label asp-for="TDSAmount" class="block font-medium text-gray-700 mb-1">TDS Amount</label>
                    <input asp-for="TDSAmount" id="TDSAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
               
               
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="NetPayableAmount" class="block font-medium text-gray-700 mb-1">Net Payable Amount</label>
                    <input asp-for="NetPayableAmount" id="NetPayableAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
                <div>
                    <label asp-for="Remark" class="block font-medium text-gray-700 mb-1">Remark</label>
                    <textarea asp-for="Remark" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                    <span asp-validation-for="Remark" class="text-red-500 text-sm"></span>
                </div>
               
            </div>
            <div class="flex justify-end space-x-3">
                <a href="@Url.Action("Index")" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                    Cancel
                </a>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                    Create Lease
                </button>
            </div>
        </form>
    </div>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

    <script>
      
        $(document).ready(function () {
            $('.searchable-dropdown').select2({
                placeholder: "Select an option",
                allowClear: true,
                width: '100%'
            });
        });
       $(".searchable-dropdown").on("change", function () {
            debugger;
            let rate = $(this).find(":selected").data("rate");
            $("#TDSRate").val(rate || 0);
            calculateNetAmount();
        });

        $("#MonthlyLeaseAmount").on("input", function () {
            calculateNetAmount();
        });
        function calculateNetAmount() {
            let total = parseFloat(document.getElementById("MonthlyLeaseAmount").value) || 0;
            let rate = parseFloat(document.getElementById("TDSRate").value) || 0;
            let tdsAmount = (total * rate / 100);
            let netAmount = total - tdsAmount;

            document.getElementById("TDSAmount").value = tdsAmount.toFixed(2);
            document.getElementById("NetPayableAmount").value = netAmount.toFixed(2);
        }
    </script>
}
