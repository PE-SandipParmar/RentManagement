@model MonthlyRentPayment
@{
    ViewData["Title"] = "Edit Monthly Rent Payment";
}

<div class="max-w-4xl mx-auto">
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h1 class="text-2xl font-bold text-gray-900">Edit Monthly Rent Payment</h1>
        </div>

        <form asp-action="Edit" method="post" class="px-6 py-4 space-y-6">
            @Html.HiddenFor(m => m.Id)
            <div asp-validation-summary="ModelOnly" class="text-red-600"></div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="EmployeeId" class="block text-sm font-medium text-gray-700 mb-1">Name (Employee)</label>
                    <select asp-for="EmployeeId" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Employees, "Id", "Name", Model.EmployeeId))">
                        <option value="0">Select</option>
                    </select>
                    <span asp-validation-for="EmployeeId" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="VendorId" class="block text-sm font-medium text-gray-700 mb-1">Owner's Name</label>
                    <select asp-for="VendorId" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Vendors, "Id", "Name", Model.VendorId))">
                        <option value="0">Select</option>
                    </select>
                    <span asp-validation-for="VendorId" class="text-red-500 text-sm"></span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="LeaseId" class="block text-sm font-medium text-gray-700 mb-1">Lease Ref.</label>
                    <select asp-for="LeaseId" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            asp-items="@(new SelectList(ViewBag.Leases, "Id", "Name", Model.LeaseId))">
                        <option value="0">Select</option>
                    </select>
                    <span asp-validation-for="LeaseId" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="PaymentMonth" class="block text-sm font-medium text-gray-700 mb-1">Payment Month</label>
                    <input asp-for="PaymentMonth" type="month" class="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    <span asp-validation-for="PaymentMonth" class="text-red-500 text-sm"></span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="MonthlyLeaseAmount" class="block font-medium text-gray-700 mb-1">Monthly Lease Amount</label>
                    <input asp-for="MonthlyLeaseAmount" id="MonthlyLeaseAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" type="number" step="0.01" />
                    <span asp-validation-for="MonthlyLeaseAmount" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="TDSApplicableId" class="block font-medium text-gray-700 mb-1">TDS Applicable</label>
                    <select asp-for="TDSApplicableId" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="0">Select TDS Applicable</option>
                        @foreach (var item in ViewBag.TDSApplicable)
                        {
                            if (item.Id == Model.TDSApplicableId) {
                                <option value="@item.Id" data-rate="@item.Rate">@item.Name</option>
                            }
                            else{
                                <option value="@item.Id" data-rate="@item.Rate" selected>@item.Name</option>

                            }
                        }
                    </select>

                    <span asp-validation-for="TDSApplicableId" class="text-red-500 text-sm"></span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="TDSRate" class="block font-medium text-gray-700 mb-1">TDS Rate</label>
                    <input asp-for="TDSRate" id="TDSRate" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
                <div>
                    <label asp-for="TDSAmount" class="block font-medium text-gray-700 mb-1">TDS Amount</label>
                    <input asp-for="TDSAmount" id="TDSAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="NetPayableAmount" class="block font-medium text-gray-700 mb-1">Net Payable Amount</label>
                    <input asp-for="NetPayableAmount" id="NetPayableAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly />
                </div>
                <div>
                    <label asp-for="Remark" class="block font-medium text-gray-700 mb-1">Remark</label>
                    <textarea asp-for="Remark" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                    <span asp-validation-for="Remark" class="text-red-500 text-sm"></span>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <a href="@Url.Action("Index")" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                    Cancel
                </a>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                    Update Payment
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById("TDSApplicableId").addEventListener("change", function () {
            let rate = this.options[this.selectedIndex].getAttribute("data-rate");
            document.getElementById("TDSRate").value = rate || 0;
            calculateNetAmount();
        });

        document.getElementById("MonthlyLeaseAmount").addEventListener("input", calculateNetAmount);

        function calculateNetAmount() {
            let total = parseFloat(document.getElementById("MonthlyLeaseAmount").value) || 0;
            let rate = parseFloat(document.getElementById("TDSRate").value) || 0;
            let tdsAmount = (total * rate / 100);
            let netAmount = total - tdsAmount;

            document.getElementById("TDSAmount").value = tdsAmount.toFixed(2);
            document.getElementById("NetPayableAmount").value = netAmount.toFixed(2);
        }
    </script>
}
